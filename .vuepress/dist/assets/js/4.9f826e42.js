(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{170:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("Slack Bot をサーバーレスで運用したい、という需要、それなりにあると思います。")]),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("これを行うには、"),a("a",{attrs:{href:"https://api.slack.com/slash-commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("Slack API の Slash Commands"),a("OutboundLink")],1),t._v(" という機能を使います。\n普通に使う分には問題にはならないのですが、ことサーバーレスとなると、若干面倒な問題があります。")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("cf. https://api.slack.com/slash-commands#responding_to_commands")]),t._v(" "),a("p",[t._v("そしてサーバーレスならではの事情として、どうしても "),a("strong",[t._v("ランタイムを起動する時間が必要")]),t._v(" という問題があります。\ncf. "),a("a",{attrs:{href:"https://d0.awsstatic.com/events/jp/2017/summit/devday/D4T7-2.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("全部教えます！ サーバレスアプリのアンチパターン とチューニング"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("↑の資料は Lambda の記述ですが、Lambda に限った話ではないでしょう。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("ただ、3 秒経った後に、Slack に POST する手段が無い訳ではありません。")]),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("cf. https://api.slack.com/slash-commands#responding_to_commands")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),a("p",[t._v("体感で 7 秒くらい掛かってそうですが、タイムアウトの表示はされませんね！")]),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("では、具体的にどのように対策したか、AWS Lambda の場合と、Cloud Functions for Firebase の場合とで、解説します。")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/lambda-services.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("他のサービスで AWS Lambda を使用する - AWS Lambda"),a("OutboundLink")],1),t._v(" を見るに、"),a("strong",[t._v("API Gateway の場合は同期呼び出し")]),t._v(" になるので、要は、"),a("strong",[t._v("callback でもレスポンスを返せる")]),t._v(" ということです。")]),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),a("hr"),t._v(" "),t._m(26),t._v(" "),t._m(27),t._m(28),t._v(" "),a("p",[t._v("こんな流れになります。")]),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("実際に、私が自作の Slack Bot で実装したコードはこちらです。\nhttps://github.com/saken649/NameThinkingLambda/blob/master/name-thinking/app.js")]),t._v(" "),t._m(30),t._v(" "),a("p",[t._v("Cloud Functions for Firebase は Lambda に比べるとかなりライトな印象です。\n"),a("a",{attrs:{href:"https://firebase.google.com/docs/functions/http-events?hl=ja",target:"_blank",rel:"noopener noreferrer"}},[t._v("Express ベースで普通に動いちゃう"),a("OutboundLink")],1),t._v(" くらいなので、Express を少しでも触ったことがある方なら、すぐ取っ付けるのが特徴です。\nここでも、Express ベースで説明します。")]),t._v(" "),a("p",[t._v("Express も例によって、レスポンスを返してもなお、その後の処理を続行させることが出来ます。\nhttps://expressjs.com/ja/4x/api.html#res.send")]),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),a("hr"),t._v(" "),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),a("p",[a("a",{attrs:{href:"https://firebase.google.com/docs/functions/http-events?hl=ja",target:"_blank",rel:"noopener noreferrer"}},[t._v("3 点目は公式マニュアルにそう書いてあります。"),a("OutboundLink")],1)]),t._v(" "),t._m(37),t._v(" "),a("p",[t._v("実際に、私が自作の Slack Bot で実装したコードはこちらです。[^1]\nhttps://github.com/saken649/NameThinking/blob/master/functions/index.js\n[^1]: Firebase 版が元ネタです。Lambda 版は、それを移植したものだったりします。")]),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),a("p",[t._v("自分のコードも、202 に書き換えちゃいました。\nので、冒頭でお見せした Firebase のログでは、202 で残っています。")]),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),a("p",[t._v("真っ先にレスポンス返して、非同期でもなくそのまま処理が続く、というのは裏技的な感じもするのですが。。。\nひとまず、このような形でシンプルに対策が取れるので、サーバーレスで運用している Slack Bot のタイムアウト対策に苦労されている方は、一度お試しください。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"はじめに"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#はじめに","aria-hidden":"true"}},[this._v("#")]),this._v(" はじめに")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("ここで Slack Bot と呼んでいるのは、例えば、こういうのです。\nhttps://github.com/saken649/NameThinking\nhttps://github.com/saken649/NameThinkingLambda\n"),s("code",[this._v("/ntcamel ユーザー名を取得する")]),this._v(" と打ったら、"),s("code",[this._v("getUsername")]),this._v(" と返してくれる、そんなのです。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-秒の壁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-秒の壁","aria-hidden":"true"}},[this._v("#")]),this._v(" 3 秒の壁")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("この Slash Commands ですが、Slack が Bot にリクエストを投げてから 3,000ms 以内、つまり "),s("strong",[this._v("3 秒以内にレスポンスが返ってこないとタイムアウト")]),this._v(" になります。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("This confirmation must be received by Slack within 3000 milliseconds of the original request being sent, otherwise a Timeout was reached will be displayed to the user.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("この 3 秒には、もちろん "),s("strong",[this._v("ランタイムの起動時間も含めて")]),this._v("、なので、実は意外と厳しいです。\nコールドスタートしようものなら、3 秒はかなり厳しいです。というか無理では。。\n例えば、上記紹介した NameThinking の場合だと、外部の API への問い合わせを行ったりしているので、コールドスタート踏んづけると 3 秒は無理です。\nタイムアウト必至ですね。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-秒経過後に-post-出来るか？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-秒経過後に-post-出来るか？","aria-hidden":"true"}},[this._v("#")]),this._v(" 3 秒経過後に POST 出来るか？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Back when you received the data payload after the command was invoked, there will have been a "),s("code",[this._v("response_url")]),this._v(" field included. This URL can be used to send responses after the 3000ms window has closed.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Slack からの RequestBody に含まれる "),s("code",[this._v("response_url")]),this._v(" は、3 秒経った後も使えるので、そこに対して POST すれば OK です。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("タイムアウトするけど POST は受け付けてるので、結果、POST 出来ている、という例です。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/e2dfbaf6-ba26-ad46-f729-b217590d5b4a.png",alt:"image.png"}}),this._v("\nなんか奇妙な状態ですね。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("そして、動いてるとはいえタイムアウトなので、バッチリそういうログも残ります。画像は Firebase のログです。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/a5e8b390-cbbf-38c0-2e9f-004891a1be16.png",alt:"image.png"}}),this._v("\nアラートとか仕込んでるなら、アラート上がっちゃうかもしれません。\nなので、タイムアウトさせないようにしないといけません。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"本題：対策方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本題：対策方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 本題：対策方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("3 秒以内に、レスポンスが返る必要がある")]),this._v(" "),s("li",[this._v("でも、起動時間なども考えると、意外とシビア")]),this._v(" "),s("li",[this._v("Slack への POST 自体は 3 秒経過後でも OK")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("タイムアウト対策を調べると、非同期処理で Lambda から別の Lambda 呼ぶ。。。とか割と出てくるのですが、実はそこまでしなくても出来ました。\n"),s("strong",[this._v("とりあえず、レスポンスを真っ先に返して、そのまま処理続ければ良さそう")]),this._v(" です。\n処理続けるのも、非同期処理とか不要でした。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"実際対策した結果はこちら"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#実際対策した結果はこちら","aria-hidden":"true"}},[this._v("#")]),this._v(" 実際対策した結果はこちら")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/d7312b1d-2d4c-58fb-b826-e91b0cb4e998.gif",alt:"May-10-2019 01-24-47.gif"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Firebase のログを見てみても、冒頭でお見せしたのとは違って、タイムアウトのログも残っていません。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/9870e4f6-e91e-4c59-24a2-de2170babf3b.png",alt:"image.png"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"aws-lambda-の場合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aws-lambda-の場合","aria-hidden":"true"}},[this._v("#")]),this._v(" AWS Lambda の場合")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Lambda 関数のハンドラーの第 ３ 引数に、コールバックを指定することが出来ます。\nこのコールバック、ざっくり言うと "),s("code",[this._v("呼び出し元にレスポンスを明示的に返す")]),this._v(" ということが出来ます。\nhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/nodejs-prog-model-handler.html#nodejs-prog-model-handler-callback")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("lambdaHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" statusCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Are you a teapot?"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上記コードを記述した Lambda 関数を API Gateway 経由で API として呼び出した場合、API の呼び出し元に、HTTP Status が "),s("code",[this._v("418 I'm a teapot")]),this._v(" 、ResponseBody が "),s("code",[this._v("Are you a teapot?")]),this._v(" として返ってきます。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Lambda 関数が同期的に呼び出された場合、コールバックでレスポンスの本文が返ります。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("そして重要なのが、"),s("strong",[this._v("callback した後も、return されるまで処理は続行")]),this._v(" されます。\nこんな Lambda 関数があったとします。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("lambdaHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" statusCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Are you a teapot?'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I\'m a teapot."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'You are a teapot.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'We are teapots!!!!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'statusCode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello teapot'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("コレを動かすとこうなります。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/22f37750-2239-5e7b-8d85-c3ff094f052e.png",alt:"image.png"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("200 OK")]),this._v(" ではなく、"),s("code",[this._v("418 I'm a teapot")]),this._v(" が返ってきながら、"),s("code",[this._v("console.log()")]),this._v(" も実行されているのがお分かり頂けるかと思います。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("この "),s("strong",[this._v("callback した後も、return されるまで処理は続行される")]),this._v(" という性質を活かすと、以下のようなコードになります。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("lambdaHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 何よりもまず Slack にレスポンスを返す")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" statusCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以降は普通に処理続行")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some codes...")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        statusCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("処理の冒頭で、"),a("code",[t._v("callback")]),t._v(" でとりあえず "),a("code",[t._v("200 OK")]),t._v(" を返しておく")]),t._v(" "),a("li",[t._v("あとは、3 秒の壁を気にせず、処理を続行する")]),t._v(" "),a("li",[t._v("return で返す ResponseBody は空にする")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("3点目は別に好き好きではあるのですが、律儀に返すと、Slack も律儀に表示してくれちゃうので、注意が必要です。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/d86220db-c275-5f08-02cb-cacd4c381fd1.png",alt:"image.png"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"cloud-functions-for-firebase-の場合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cloud-functions-for-firebase-の場合","aria-hidden":"true"}},[this._v("#")]),this._v(" Cloud Functions for Firebase の場合")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" functions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'firebase-functions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/teapot'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'We are teapots.'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'He is a teapot.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"She isn\'t a teapot..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ah? Coffee cup?"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hello "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" functions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("コレを動かすとこうなります。\n"),s("img",{attrs:{src:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159578/3128e3e3-c55d-425b-403b-81879e8879aa.png",alt:"image.png"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("こちらも "),s("code",[this._v("418 I'm a teapot")]),this._v(" が返ってきながら、"),s("code",[this._v("console.log()")]),this._v(" も実行されているのがお分かり頂けるかと思います。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("こちらも "),s("strong",[s("code",[this._v("res.status().send()")]),this._v(" した後も処理が続行される")]),this._v(" という性質を活かすと、以下のようなコードになります。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" functions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'firebase-functions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/bot'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 何よりもまず Slack にレスポンスを返す")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以降は普通に処理続行")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some codes...")]),t._v("\n\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" functions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("処理の冒頭で、"),a("code",[t._v("res.status(200).send()")]),t._v(" でとりあえず "),a("code",[t._v("200 OK")]),t._v(" を返しておく")]),t._v(" "),a("li",[t._v("あとは、3 秒の壁を気にせず、処理を続行する")]),t._v(" "),a("li",[a("code",[t._v("res.end()")]),t._v(" で明示的に終了する")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("重要: すべての HTTP 関数が正しく終了するようにしてください。関数を正しく終了することで、関数が長時間実行されて過剰な課金がされるということがなくなります。res.redirect()、res.send()、res.end() で HTTP 関数を終了します。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"ちなみに"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ちなみに","aria-hidden":"true"}},[this._v("#")]),this._v(" ちなみに")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("どちらの例でも "),s("code",[this._v("200 OK")]),this._v(" を返していましたが、厳密に言うなら、受け付けただけで処理は終わってないので "),s("code",[this._v("202 Accepted")]),this._v(" を返すのが適切かもしれませんね。\nhttps://developer.mozilla.org/ja/docs/Web/HTTP/Status/202")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("なお、問答無用で 200 番台を返すということは、裏を返すと、エラーが起きても 500 番台とか返せない、ということなので、その時の処理は、 "),s("code",[this._v("console.log()")]),this._v(" の出し方などで、工夫してどうにかするしか無さそうです。\n私の Bot は大したことない個人運用の Bot なので特に考えてませんでしたが、業務利用する Bot の場合は、ちゃんと考えた方が良さそうですね。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"おわりに"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#おわりに","aria-hidden":"true"}},[this._v("#")]),this._v(" おわりに")])}],!1,null,null,null);s.default=e.exports}}]);